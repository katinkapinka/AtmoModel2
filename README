Solved problems in create_midfile()
just some minor issues left and some "plastic surgery"